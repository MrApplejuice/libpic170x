<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libpic170x: Library configuration header</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.svg.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libpic170x
   &#160;<span id="projectnumber">0.2</span>
   </div>
   <div id="projectbrief">Ease of use library for PIC16(L)1705/1709 chips</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Library configuration header </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md2">Matching library and project configurations</a><ul><li class="level2"><a href="#autotoc_md3">Configuring the correct processor type and frequency</a></li>
<li class="level2"><a href="#autotoc_md4">Verify correct configuration</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>The header file <a class="el" href="freq_8h.html" title="Global timing definitions used for timing critical library components. ">libpic170x/freq.h</a> contains library frequency and timing related configurations and functions to verify that a linked library matches the configuration of a built target project. Verifying timing settings is important because the main processor frequency is used for many components of libpic170x and therefore must match the frequency that the PIC micro controller is run on.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Matching library and project configurations</h1>
<p>The library can be built for different PIC micro controllers and/or different <em>static</em> processor speeds (see <a class="el" href="index.html#mainpage-as-library">build instructions</a> for details). When using libpic170x by including it as a static library, one must select the apropriate static library for the selected chip type and chip processing speed. The chip type and clock frequencies are burned into the different variants of libpic170x during building and all libraries depend on this burned-in chip type and clock frequency.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Configuring the correct processor type and frequency</h2>
<p>The processor type for a project using libpic170x is implicitly declared through preprocessor macros exposed by xc8's <code>xc.h</code> header. The processor frequency, is declared by delcaring the preprocessor macro <code>_XTAL_FREQ</code> which is also optionally used by <code>xc.h</code>, but it is required to be declared before using any component of libpic170x. To set _XTAL_FREQ project-wide, it is advisable to define it in the project settings such that it is used for all source files of a given project, for example:</p>
<div class="fragment"><div class="line">xc8 -D_XTAL_FREQ=1000000</div></div><!-- fragment --><p>However, it is also possible for a small project to locally define the macro or define it through a config-header file which is include before <code><a class="el" href="freq_8h.html" title="Global timing definitions used for timing critical library components. ">freq.h</a></code> is included.</p>
<p>To help configuring the actual processor speed to match _XTAL_FREQ, <a class="el" href="freq_8h.html" title="Global timing definitions used for timing critical library components. ">freq.h</a> defines the macro OSCCON_BITS which can be directly assigned to the OSCCON register to set the processor speed. It is advisable to do this at the very start of your program:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define _XTAL_FREQ 1000000</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;lipbic170x/timer0.h&gt;</span> <span class="comment">// This will include freq.h</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div><div class="line">    <span class="comment">// Set OSCCON bits from macro that is defined in freq.h</span></div><div class="line">    OSCCON = <a class="code" href="freq_8h.html#a81e599cd09f068433a3da0297516af84">OSCCON_BITS</a>;</div><div class="line"></div><div class="line">    <span class="comment">// ... now start the program ...</span></div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
Verify correct configuration</h2>
<p>To check if the configured project _XTAL_FREQ and processor type matches the static link library, <a class="el" href="freq_8h.html" title="Global timing definitions used for timing critical library components. ">freq.h</a> defines a handy but optional utility function <a class="el" href="freq_8h.html#a7c00b7eec0fafa21727e9623d9ec3015" title="Verify matching configuration parameters between main project and static library. ...">libpic170x_check_library_build_arguments()</a>. The function can be called to verify that the correct project configuration has been used to build a project that links to a libpic170x static library. It returns true, if the configuration parameter match the library's configuration. I case that the function returns false, the application should exit into a safe fail state and not attempt to use libpci170x since its behavior will be undefined. As such, if you call the check-function, you should do so ath the very start of your program.</p>
<p>See the <a class="el" href="main_8c.html">blink.X/main.c</a> for an example. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
